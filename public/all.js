!function(i,o,e,a){function n(){}function r(e,n,t){return 10*(t+e/4<<0)+n+e%4}function f(e,n){return e.repeat(n)}function l(e,n){return w.substr(e,n)}function c(){U=1,e(t),v()}function u(){U=0,v(),g()}function s(e,n){var t=19*a.random()<<0;return Object.assign({x:4+(T[t]?T[t]:0),y:0,c:0,i:t},e,n)}function d(t){if(!E[t.i].some(function(e,n){if(n=r(n,t.x,t.y),e&&(200<=n||h[n]))return 1}))return t}function p(){R=h.slice(),E[O.i].map(function(e,n){n=r(n,O.x,O.y),void 0!==R[n]&&(R[n]=R[n]||e)})}function y(){var e=s(O,{y:O.y+1,c:O.c+1});if(O=d(e)||O,p(),O===e)return 1;if(!O.c)return N=1,I=(new Date-I)/1e3<<0,void o(function(){K(A,x,C,I)});A+=10*x,O=L,L=s(),h=R;for(var n=200,t=0,r=0;n-=10;)h.slice(n,n+10).every(i)&&(h.splice(n,10),r+=10,t<4&&t++,++C%10==0&&(x=x<9?x+1:1));for(;r--;)h.unshift(0);A+=[0,50,150,350,1e3][t]*x,h.some(i)||(A+=2e3*x),R=h,p()}function v(){var e="\n\r",n=f(" ",28),t=n+"<!",r="!>"+n,i=r+t,o=String.fromCharCode(9646),a=f(o,2),c=f(" ",80)+e;if(M)return n=f(" ",19),w=[-58917640,-942919668,858981133,-2096247688,-1023360221,53509168,-858816512].map(function(e){return(f("0",10)+(e>>>0).toString(2)).substr(-32)}).join("").substr(0,210).split("").map(function(e){return[" ",o][e]}).join("").match(/.{1,42}/g).join(n+e+n),void(w=f(c,8)+n+w+n+e+f(c,4)+f(" ",33)+"PRESS ANY KEY"+f(" ",34)+e+f(c,7));w=t+(w=R.map(function(e){return[" .",a][e]}).join("").match(/.{20}/g).join(i))+i+f("=",20)+r+n+"  "+f("\\/",10)+"  "+n;var u=C.toString();u="ROWS HIT:"+f(" ",15-u.length)+u,w=u+l(24);var s=A.toString().reverse().match(/.{1,3}/g).join(" ").reverse();s="SCORE:"+f(" ",18-s.length)+s,w=l(0,80)+s+l(104),w=l(0,160)+"LEVEL:"+f(" ",17)+x+l(184),E[L.i].map(function(e,n){n=80*(10+2*n/8<<0)+20+2*n%8,e&&(w=l(0,n)+a+l(n+2))}),w=l(0,138)+"UP ARROW: ROTATE"+l(154),w=l(0,216)+"DOWN ARROW: SOFT DROP"+l(237),w=l(0,298)+"SPACEBAR: HARD DROP"+l(317),w=l(0,380)+"ESC, P: PAUSE"+l(393),U&&(w=l(0,757)+"PAUSED"+l(763)),N&&(w=l(0,756)+"TRY AGAIN?"+l(766),w=l(0,836)+"   Y/N    "+l(846)),w=c+(w=w.match(/.{1,80}/g).join(e))+e+f(c,2),j(w)}function g(){e(t),N||M||(t=o(function(){y(),v(),g()},100*(10-x)))}function m(){L=s(),O=L,h=D,x=1,C=A=0,I=new Date,N=0,p(),v(),g()}var h,E,S,k,T,b,w,R,t,x,A,C,I,L,O,D,j,K,N,U,M;h="0".repeat(200).split("").map(i),E=[785,23,547,116,51,114,305,39,562,15,4369,99,306,54,561,802,113,275,71].map(function(e){return(e>>>0).toString(2).split("").reverse().map(i)}),S=[1,2,3,0,4,6,7,8,5,10,9,12,11,14,13,16,17,18,15],k=[2,3,2,3,2,3,2,3,2,4,1,3,2,3,2,2,3,2,3],T={9:-1,10:1},b={5:[0,0],6:[1,0],7:[-1,1],8:[0,0],9:[-2,2],10:[2,-1],11:[-1,1],12:[1,0],13:[-1,1],14:[1,0]},L=s(),O=L,D=h.slice(),K=j=n,U=N=0,M=1,m(),window.TETRIS={on:function(e){K=e.finish||n,(j=e.nextFrame||n)(w)},pause:c,pressKey:function(e){if(M)return M=0,void m();if(N&&e in{89:1,78:1})switch(N=0,e){case 89:m();break;case 78:M=1,v()}if(!N)if(U)u();else{if(e in{27:1,80:1}&&c(),e in{37:1,38:1,39:1}){var n=s(O);switch(e){case 37:n.x=0===n.x?0:n.x-1;break;case 39:var t=10-k[n.i];n.x=n.x===t?t:n.x+1;break;case 38:var r=S[O.i],i=0,o=0;b[r]&&(i=b[r][0],o=b[r][1]),(n=s(O,{x:O.x+i,y:O.y+o,i:r})).x=a.min(n.x,10-k[n.i]),n.x=a.max(n.x,0)}O=d(n)||O,p(),v()}if(e in{40:1,32:1}){switch(e){case 40:y();break;case 32:for(;y(););}v(),g()}}},start:m,upause:u}}(parseFloat,setTimeout,clearTimeout,Math),String.prototype.reverse=function(){for(var e="",n=this.length;n--;)e+=this.charAt(n);return e},function(){var r,t,n,i,o,a=[];function c(e,n){if(e&&!o){var t=r.createBufferSource();return t.buffer=e,t.connect(r.destination),n&&(t.loop=!0),t.start(0),t}}function e(e,t){function n(e){var n=new XMLHttpRequest;n.open("GET","./public/"+e,!0),n.responseType="arraybuffer",n.onload=function(){r.decodeAudioData(n.response,t,function(e){e.err})},n.send()}e.map&&e.map(n)||n(e)}r=new(window.AudioContext||window.webkitAudioContext),e(["key1.ogg","key2.ogg","key3.ogg","key4.ogg"],function(e){a.push(e)}),e("space.ogg",function(e){t=e}),e("ambience.ogg",function(e){i=c(n=e,!0)}),e("beep.ogg",c),document.getElementById("mute-sound").addEventListener("click",function(e){(o=!o)?i&&i.stop(0):i=c(n,!0),e.target.innerHTML=o?"UNMUTE SOUND":"MUTE SOUND",e.target.blur()}),window.playAudioKey=function(e){if(32!==e){var n=Math.random()*a.length<<0;c(a[n])}else c(t)}}(),function(){var i="&nbsp;";function u(e){return e.toString().split("").reverse().join("").match(/.{1,3}/g).join(" ").split("").reverse().join("")}function s(e,n,t){var r=t-e.length-n.length;return e+i.repeat(0<r?r:0)+n}function f(e){return document.getElementById(e)}function t(e,n,t){function r(e){(e.which||e.keyCode)===t&&n()}return e.addEventListener("keydown",r),function(){e.removeEventListener("keydown",r)}}function l(e,n){return t(e,n,27)}function o(e,n,t){function r(){f("userboard-close").removeEventListener("click",r),f("userboard").style.display="none",c(),t()}f("userboard").style.display="block",f("your-score").innerHTML=s("YOUR SCORE:",u(e.score),32);try{var i=(new Date).getTime(),o=JSON.parse(localStorage.getItem("tetrisScore"))||[];o.push({t:i,s:e.score}),localStorage.setItem("tetrisScore",JSON.stringify(o));var a=o.sort(function(e,n){return n.s-e.s})[0].s;f("your-best-score").innerHTML=s("YOUR BEST SCORE:",u(a),32)}catch(e){}try{f("name-input").value=localStorage.getItem("tetrisName")}catch(e){}f("userboard-close").addEventListener("click",r);var c=l(document,r)}function n(e){if(e.target.dataset&&e.target.dataset.key){var n=parseInt(e.target.dataset.key);TETRIS.pressKey(n),playAudioKey(n),e.target.blur()}}function a(){var t,r;function i(e){clearInterval(t),t=0}function e(e){if(!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey||(keyCode=0<e.which?e.which:e.keyCode,t&&keyCode===r))){r=keyCode;function n(){TETRIS.pressKey(keyCode)}n(),i(),playAudioKey(keyCode);t=setInterval(n,{37:100,39:100,40:50}[keyCode]||200),e.preventDefault()}}return TETRIS.upause(),setTimeout(function(){addEventListener("keyup",i),addEventListener("keydown",e),addEventListener("click",n)}),function(){clearInterval(t),removeEventListener("keyup",i),removeEventListener("keydown",e),removeEventListener("click",n),TETRIS.pause()}}var c=a();TETRIS.on({finish:function(e,n,t,r){c(),o({score:e,level:n,rowsHit:t,time:r},0,function(){TETRIS.start(),c=a()})},nextFrame:function(e){e=e.replace(/[ <>]|\n\r/g,function(e){return{" ":"&nbsp;","<":"&lsaquo;",">":"&rsaquo;","\n\r":"<br>"}[e]}),f("game").innerHTML=e}})}(),function(e){var n=e.createElement("link");n.rel="stylesheet",n.href="./public/styles.css",e.body.appendChild(n)}(document);